<div class="ous-sidebar {{if this.collapsed 'collapsed'}}" style="width: {{this.sidebarWidth}}px;">
  <div class="online-users-header" {{on "click" this.toggleCollapseFn}}>
    <span class="header-text">Online Users ({{this.totalOnlineCount}})</span>
    <span class="collapse-icon">
      {{#if collapsed}}
        ▶
      {{else}}
        ▼
      {{/if}}
    </span>
  </div>

  {{#unless this.collapsed}}
    <div class="online-users-content">
      {{#if this.loading}}
        <div class="loading-container">
          <div class="spinner"></div>
          <span>Loading online users...</span>
        </div>
      {{else}}
        {{#each this.sortedGroups as |group|}}
          <div class="user-group">
            <div class="group-header">
              {{group.displayName}}
            </div>
            <div class="user-list">
              {{#each group.users as |user|}}
                <div class="user-item" title="{{user.username}}">
                  {{#if this.siteSettings.online_user_show_avatars}}
                    {{avatar user imageSize="small" extraClasses="user-avatar"}}
                  {{/if}}
                  <a class="user-name trigger-user-card" data-user-card="{{user.username}}" href="/u/{{user.username}}" {{on "click" (fn this.openUserCardFn user)}}>{{user.username}}</a>
                </div>
              {{/each}}
            </div>
          </div>
        {{else}}
          <div class="no-users">
            No users online
          </div>
        {{/each}}
      {{/if}}
    </div>
  {{/unless}}
</div>

{{#if this.showCustomCard}}
  <div class="ous-modal-overlay" {{on "click" this.closeCardFn}}>
    <div class="ous-modal" {{on "click" this.stopPropFn}}>
      {{#if this.customCardLoading}}
        <div class="ous-modal-loading">
          <div class="spinner"></div>
          <span>Loading…</span>
        </div>
      {{else if this.customCardError}}
        <div class="ous-modal-error">
          Failed to load user card.
        </div>
      {{else}}
        <div class="ous-modal-header">
          <div class="user">
            {{#if this.customCardData}}
              {{avatar this.customCardData imageSize="large" extraClasses="modal-avatar"}}
            {{/if}}
            <div class="names">
              <span class="username">@{{this.customCardData.username}}</span>
              {{#if this.customCardData.name}}
                <span class="name">{{this.customCardData.name}}</span>
              {{/if}}
            </div>
          </div>
          <button class="btn btn-flat close" {{on "click" this.closeCardFn}} aria-label="Close">×</button>
        </div>

        <div class="ous-modal-body">
          {{#if this.customCardData.bio_cooked}}
            <div class="bio cooked">{{html-safe this.customCardData.bio_cooked}}</div>
          {{/if}}

          {{#if this.customCardData.stats}}
            <div class="user-stats">
              <span class="stat">{{this.customCardData.stats.posts_read_count}} read</span>
              <span class="stat">{{this.customCardData.stats.topic_count}} topics</span>
              <span class="stat">{{this.customCardData.stats.post_count}} posts</span>
            </div>
          {{/if}}

          <div class="actions">
            <a class="btn btn-primary" href="/u/{{this.customCardData.username}}">View Profile</a>
          </div>
        </div>
      {{/else}}
      {{/if}}
    </div>
  </div>
{{/if}}
